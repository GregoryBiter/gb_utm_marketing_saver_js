const utmHandler={getUrlParams:()=>{let e={};const o=window.location.search,r=new URLSearchParams(o);return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach((o=>{e[o]="utm_source"===o?r.get(o)||"direct":r.get(o)||""})),e=utmHandler.setUtmSourceFromReferrer(e),e=utmHandler.otherUrlParams(e,r),e},setUtmSourceFromReferrer:e=>{const o=document.referrer,r=window.location.hostname;if(o&&!o.includes(r)){const r=new URL(o).hostname,t={"google.com":{source:"google",medium:"organic"},"bing.com":{source:"bing",medium:"organic"},"yahoo.com":{source:"yahoo",medium:"organic"},"duckduckgo.com":{source:"duckduckgo",medium:"organic"},"instagram.com":{source:"instagram",medium:"social"},"l.instagram.com":{source:"instagram",medium:"social"},"facebook.com":{source:"facebook",medium:"social"},"l.facebook.com":{source:"facebook",medium:"social"},"m.facebook.com":{source:"facebook",medium:"social"},"twitter.com":{source:"twitter",medium:"social"},"linkedin.com":{source:"linkedin",medium:"social"}};e.utm_source||(t[r]?e.utm_source=t[r].source:e.utm_source=r),e.utm_medium||(t[r]?e.utm_medium=t[r].medium:e.utm_medium="referral")}return e},otherUrlParams:(e,o)=>(e.utm_source||(o.has("fbclid")?(e.utm_source="facebook",e.utm_medium="social"):o.has("gclid")?(e.utm_source="google",e.utm_medium="cpc"):o.has("dclid")&&(e.utm_source="doubleclick",e.utm_medium="display")),e),setCookie:(e,o,r)=>{let t="";if(r){const e=new Date;e.setTime(e.getTime()+24*r*60*60*1e3),t="; expires="+e.toUTCString()}document.cookie=e+"="+(o||"")+t+"; path=/"},getCookie:e=>{const o=e+"=",r=document.cookie.split(";");for(let e=0;e<r.length;e++){let t=r[e];for(;" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(o))return t.substring(o.length)}return null},saveUtmAndReferrerToCookies:()=>{const e=utmHandler.getUrlParams(),o=document.referrer,r=window.location.hostname;let t=JSON.parse(utmHandler.getCookie("utm_data")||"{}");t.first_visit||(t.first_visit={utm:e,referrer:o&&!o.includes(r)?o:""});const m=t.first_visit.utm,i=t.first_visit.referrer;JSON.stringify(e)===JSON.stringify(m)&&o===i||"direct"!==e.utm_source&&(t.second_visit={utm:e,referrer:o&&!o.includes(r)?o:""}),utmHandler.setCookie("utm_data",JSON.stringify(t),30)},getUtmAndReferrerFromCookies:()=>{try{const e=JSON.parse(utmHandler.getCookie("utm_data")||"{}");return e.first_visit&&e.first_visit.utm?e:{}}catch(e){return console.error("Ошибка при чтении куки:",e),{}}}};window.utmHandler=utmHandler,"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=utmHandler),window.onload=()=>{"function"==typeof utmHandler.saveUtmAndReferrerToCookies?(utmHandler.saveUtmAndReferrerToCookies(),console.log(utmHandler.getUtmAndReferrerFromCookies())):console.error("Функция saveUtmAndReferrerToCookies не определена")};